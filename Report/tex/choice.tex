In this chapter we present the reasons for choosing V-Rep as the simulator and Blender as the modelling tool for this project. 

\section{Problem statement} 
We want to find a simulation tool able of simulating physics elements such as inertias, frictions, collisions, joints (hinge, spring-dampers). We also want to get some feedback from the simulation, like acceleration of the objects and their position. Simulation of vision sensors would be a plus, but is not the primary selection criterion. We also want to keep the control code separated from the simulation.

\section{Available tools}
\subsection{Barebone physics engines}
The physics engine is the cornerstone of a physics simulation tool. There exist a quantity of them, we present here the most popular ones that have the the following features' set :  multi rigid body dynamics, collision detection, joints (hinge, spring-dampers, generic 6DOF\footnote{DOF : degree of freedom}). 

\begin{enumerate}
\item \textbf{Bullet:} As of now, it is the most popular open source physics engine. Primarily used for games\footnote{Most notably in the Grand Theft Auto(GTA) games series} it is also used in more serious applications such as Blender, V-Rep or NASA's tensegrity robotics toolkit. 

\item \textbf{ODE:} Open source, a little older that Bullet. As it was already mature when simulators started to be developed, it is present in a lot of robotics simulation tools (V-Rep, Webots, Gazebo...). It was also designed with games in mind but was influenced by its success in more serious applications.

\item \textbf{Newton:} Another open source engine, not quite as popular as Bullet and ODE but nevertheless used for commercial games and simulation. What makes it stand out in the crowd is its deterministic constraint solver, as opposed to iterative solvers used by Bullet and ODE.

\item \textbf{PhysX \& Havok:} Both are proprietary engines used primarily for games. They won't be further discussed because their focus is on speed rather than accurateness and as such they cannot be used in a simulation that aims to be realistic, as stated by Erez \textit{et al} in \cite{engines_comparison}.
\end{enumerate}

\subsection{Simulators}
In this section we will speak of software that provides a higher level interface to the physics engines we presented earlier. That interface usually adds a visualization and some other useful features.
\begin{enumerate}

\item \textbf{Blender\cite{Bruyninckx04}} is 3D modelling software suite and as such has integrated the Bullet engine to help make more realistic animations. It features the ability to make Python scripts that use that engine to make games or physics simulations. It is cross platform.

\item \textbf{Gazebo} is the official simulator for the DARPA Atlas challenge. It features multiple physics engines (Bullet ,Simbody, Dart and ODE), allows custom plugins and uses the SDF format for its models. It is open source and runs natively on Linux systems but needs to be compiled in order to run on Windows or OSX.

\item \textbf{V-Rep :} is another simulator that lets you choose the physics engine(Bullet, ODE, Newton, Vortex) and it also allows custom plugins in the form of LUA scripts. It is cross-platform and uses its own format for storing models but can import standard formats(COLLADA, 3ds, etc...). It is free to use for educational purpose.

\item \textbf{Webots :} has virtually the same features as V-Rep but is not free.

\item \textbf{Matlab :} Not a dedicated robotics simulator per se but can be used to model the robot analytically and to write simulation code for it. 
\end{enumerate}

A summary of the features of each simulator is present on \cref{table:simulators_comp}.

\begin{table}[htp]
\center
\begin{tabularx}{\textwidth}{@{} l l X X X X @{}}
\toprule
\textbf{Simulator} & \textbf{License} & \textbf{Physics engine(s)} & \textbf{Integrated editor} & \textbf{Modelling}\\ 
\midrule
Blender & Free & Bullet & Fully fledged & Internal\\ 

V-REP & Free & Bullet, ODE, Newton, Vortex(10s limit) & Limited & Can import .COLLADA\\

Gazebo & Free & Bullet, ODE, Simbody, DART & Limited & SDF format\\

Webots & Proprietary & ODE & None & SDF format\\

Matlab & Proprietary & None & None & Mathematical\\
\bottomrule
\end{tabularx}
\caption{Comparison of simulators}
\label{table:simulators_comp}
\end{table}

\section{Tested software}
In this section we try and comment on some of the presented options.
\subsection{Blender}
Blender is pleasant to use because the robot's model can be easily changed inside it (Blender is, after all, a modelling tool) and the Python scripting allows fast development. Support for a socket allows an external program to control the simulation and the robot inside it. The internals of the physics are obscured and some interesting object properties, such as inertias, are hard to reach. It is also hard to change the simulation parameters making it difficult to obtain stable results when using a higher number of objects and constraints. Furthermore, support for the game engine, the basis of a simulation project, is uncertain \cite{blender_roadmap}.

\textbf{Pros :}
\begin{itemize}
\item Easy modelling.
\item Good documentation for Python scripting.
\end{itemize}

\textbf{Cons :}
\begin{itemize}
\item Bullet's simulation parameters are hidden behind an incomplete interface.
\item Friction parameters not in a physical value.
\item Inertias approximated by identity matrix.
\end{itemize}

\subsection{Gazebo}
Gazebo is attractive because it has the support of DARPA and handles multiple physics engines. The main drawback lies in the modelling of the robot to be simulated. It does feature an internal modelling tool but it is too limited to be usable. That would not be a problem if it could import models easily but that is not the case, it uses an xml file to store the parameters of the robot and the only tool that can export models to that format is 3ds max, a commercial product.

\textbf{Pros :}
\begin{itemize}
\item Gives the choice of the physics engine
\item Inertias correctly definable
\item Friction represented in physical values.
\end{itemize}

\textbf{Cons :}
\begin{itemize}
\item Internal model editor prohibitively limited, cannot be used to create a complicated model. It cannot import popular CAD formats.
\item Uses the SDF\footnote{A XML file} format to store models, making it hard to iterate over robot designs.
\end{itemize}

\subsection{V-Rep}
V-Rep also has multiple physics engines available and has a user-friendly interface. It also has an internal modelling tool but there is not much use for it since it allows the import of models in the COLLADA format. It also supports socket communication and even provides code for a client thread in the custom application. The options of the physics engines are also pretty accessible and lots of sensor types are natively supported by the simulator.

\textbf{Pros :}
\begin{itemize}
\item Gives the choice of the physics engine.
\item Inertias correctly definable.
\item Friction represented in physical values.
\item Already used at the university.
\end{itemize}

\textbf{Cons :}
\begin{itemize}
\item Limited internal editor, can hardly be used for modelling.
\end{itemize}

\section{Choice}
The first choice to be made is whether we go for a barebone physics engines or a simulator: the former has the advantage of being a highly customizable solution but a simulator provides features a physics engines does not :\begin{itemize}
\item 3D visualization
\item code handling the import of models
\item a remote API
\end{itemize}
All these functionalities would eventually be necessary so a simulator is preferred. 

From the available simulators(Blender, Gazebo and V-Rep) the best seems to be V-Rep. This choice is further confirmed by \cite{ivaldi2014tools} which shows that V-Rep is the highest noted tools amongst roboticists.

Inside V-Rep, we chose Newton Dynamics because simple tests showed it to be the most stable with a high number of joints\footnote{with the exception of Vortex but it requires a license to run more than $10s$}.

Although Blender was not chosen as the primary simulation tool for the project, it shall be used as a modelling tool for the robot, as a complement for V-Rep.